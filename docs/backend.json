{
  "entities": {
    "User": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "User",
      "type": "object",
      "description": "Represents a user of the BookWise AI application.",
      "properties": {
        "uid": {
          "type": "string",
          "description": "Unique identifier for the user from Firebase Auth."
        },
        "email": {
          "type": "string",
          "description": "Email address of the user.",
          "format": "email"
        },
        "displayName": {
          "type": "string",
          "description": "Display name of the user."
        },
        "photoURL": {
            "type": "string",
            "description": "URL of the user's profile picture."
        }
      },
      "required": [
        "uid",
        "email"
      ]
    },
    "BookList": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "BookList",
      "type": "object",
      "description": "Represents a list of books created by a user.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the book list."
        },
        "userId": {
          "type": "string",
          "description": "Reference to the User who created the list. (Relationship: User 1:N BookList)"
        },
        "name": {
          "type": "string",
          "description": "Name of the book list."
        },
        "description": {
          "type": "string",
          "description": "Description of the book list."
        },
        "isPublic": {
          "type": "boolean",
          "description": "Indicates whether the book list is public or private."
        },
        "books": {
          "type": "array",
          "description": "A list of books in this booklist.",
          "items": {
             "$ref": "#/entities/Book"
          }
        },
        "sharedWithUserIds": {
          "type": "array",
          "description": "References to User IDs with whom the list is shared. (Relationship: BookList N:N User)",
          "items": {
            "type": "string"
          }
        },
        "likes": {
            "type": "integer",
            "description": "Number of likes the book list has received."
        }
      },
      "required": [
        "id",
        "userId",
        "name",
        "isPublic"
      ]
    },
    "Book": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Book",
      "type": "object",
      "description": "Represents a book in the system.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the book."
        },
        "title": {
          "type": "string",
          "description": "Title of the book."
        },
        "author": {
          "type": "string",
          "description": "Author of the book."
        },
        "description": {
          "type": "string",
          "description": "Description of the book."
        },
        "imageUrl": {
            "type": "string",
            "description": "URL for the book cover image."
        }
      },
      "required": [
        "id",
        "title",
        "author"
      ]
    }
  },
  "auth": {
    "providers": [
      "google.com"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "User",
          "schema": {
            "$ref": "#/backend/entities/User"
          },
          "description": "Stores user profile data.  Path-based ownership enforced via the `userId` parameter.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/book_lists/{bookListId}",
        "definition": {
          "entityName": "BookList",
          "schema": {
            "$ref": "#/backend/entities/BookList"
          },
          "description": "Stores private book lists owned by a specific user. Path-based ownership enforced by the `userId` parameter.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user."
            },
            {
              "name": "bookListId",
              "description": "The unique identifier of the book list."
            }
          ]
        }
      },
      {
        "path": "/public_book_lists/{bookListId}",
        "definition": {
          "entityName": "BookList",
          "schema": {
            "$ref": "#/backend/entities/BookList"
          },
          "description": "Stores public book lists that are accessible to all users.",
          "params": [
            {
              "name": "bookListId",
              "description": "The unique identifier of the public book list."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore structure is designed to support the BookWise AI application's book list and recommendation features. It prioritizes authorization independence and simplifies security rules. User data, book lists (both public and private), and individual books are stored in separate collections to ensure clarity and maintainability.\n\n1.  **Users Collection:** Stores user profiles, authenticated via Google Sign-in. The `users/{userId}` path makes ownership clear, and security rules can easily restrict access to a user's own profile data.\n\n2.  **Public Book Lists Collection:** Public book lists are stored in the `/public_book_lists` collection. Anyone can read from this collection. Creation is restricted to authenticated users who are validated in the rules. Writes are allowed by list owners only. This segregation supports the QAP of allowing public lists to be generally accessible without complex filtering.\n\n3.  **User-Owned Book Lists Collection:** Private book lists are stored within each user's document, at `/users/{userId}/book_lists/{bookListId}`. This path-based ownership allows simple and secure rules that restrict access to the book list creator.\n\n4.  **Books are embedded within book lists**: Instead of a global `/books` collection, books are now part of a subcollection within each book list. This simplifies data management as books are contextually tied to the list they belong to, eliminating the need for a separate top-level collection.\n\n**Authorization Independence:** The structure uses path-based ownership (e.g., `/users/{userId}/book_lists/{bookListId}`) and a dedicated `/public_book_lists` collection, eliminating the need for `get()` calls in security rules. If collaborative lists were needed, `sharedWithUserIds` would have been denormalized to a `members` map on the BookList to avoid get() calls.\n\n**QAPs:**\n\n*   Public book lists are easily accessible via the `/public_book_lists` collection.\n*   Private book lists are secured via path-based ownership under each user's document.\n*   List operations are supported efficiently due to the clear separation of public and private data."
  }
}
